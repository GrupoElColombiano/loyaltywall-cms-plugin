const url_base_loyaltiwall="https://apiclient.loyaltywall.com",admin_api="https://apiadmin.loyaltywall.com",Version="1.0.4";function decodedJWT(e){let t=e.split("."),o=t[1],a=o;a=a.replace(/-/g,"+").replace(/_/g,"/");let n=decodeURIComponent(atob(a).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}async function initKeyCloak(e,t,o,a){e.init({onload:"login-required",checkLoginIframe:!1}).then(n=>{if(n){let i=e.token;localStorage.setItem(o+"_token",i);let r=e.tokenParsed;localStorage.setItem(o+"_user_data",JSON.stringify(r)),loginEvent(a,o).then(e=>console.log("✅ login event ✅",e)).catch(e=>console.log("❌ login event ❌",e)),validateStatusButton(n,o),paywallExecute(e,t,o,n)}else paywallExecute(e,t,o,n)}).catch(e=>console.error("❌ authentication error ❌",e))}async function loginEvent(e,t){let o=localStorage.getItem(t+"_token"),a=decodedJWT(o),n=e.isPartOf.productID,i=n.split("/"),r=`${url_base_loyaltiwall}/paywall/login`,s={method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({source:{itemId:e?.articleSection,itemType:"site",scope:i[2]},properties:a,target:{itemType:"page",scope:i[2],itemId:"homepage",properties:{pageInfo:{referringURL:n}}}})};try{let l=await (await fetch(r,s)).json();return l.profileId&&localStorage.setItem("id_kc",l.profileId),l}catch(c){console.error("Error:",c)}}function createFloatingElements(e,t){let o=t.isPartOf.productID,a=document.createElement("style");a.type="text/css",a.appendChild(document.createTextNode(styleButtonAuth)),document.head.appendChild(a);let n=document.createElement("div");n.classList.add("floating-element"),document.body.appendChild(n);let i=document.createElement("button");i.textContent="LogIn",i.classList.add("floating-button"),i.id="paywall-login-button",i.addEventListener("click",function(){e.login()}),n.appendChild(i);let r=document.createElement("button");r.textContent="LogOut",r.classList.add("floating-button"),r.id="paywall-logout-button",r.addEventListener("click",function(){window.localStorage.clear(),e.logout({redirectUri:o})}),n.appendChild(r)}function validateStatusButton(e,t){let o=document.getElementById("paywall-login-button"),a=document.getElementById("paywall-logout-button");localStorage.getItem(t+"_token")?(a&&(a.style.display="block"),o&&(o.style.display="none")):(a&&(a.style.display="none"),o&&(o.style.display="block"))}async function paywallExecute(e,t,o,a){validateStatusButton(a,o);let n="",i="",r="",s="",l="",c=0,d=!1,p="",u=getOrSetUniqueId(),g=localStorage.getItem(o+"_token");if(g){let m=decodedJWT(g);p="registrado",u=m.sub}else p="anonimo";let y=new Date,f=y.getFullYear(),b=new Date(f,0,1),$=Math.floor((y-b)/6048e5)+1;var x=JSON.parse(t.textContent||t.innerText);if(n=x["@type"],i=o,r=x.identifier,l=x.articleSection,c=x.currentDateArticle,"NewsArticle"==n){if(x.hasPart.length)x.hasPart.forEach(e=>{Array.isArray(e["@type"])&&e["@type"].includes("Product")&&(s=e.category,d=e.isAccessibleForFree,i=e.name)});else if(x.hasPart["@type"].includes("Product")){var h=x.hasPart;s=h.category,d=h.isAccessibleForFree,i=h.name}"anonimo"===p?await requestAnonymusPlan().then(e=>{let{plansProductsCategory:t,idPlan:o,userType:a}=e,n=t.find(e=>!0==e.product.all_product);if(n){if(n.categorysAccess.length>0){let p=n.categorysAccess.find(e=>e.category.name.toLowerCase()==s.toLowerCase());validateMetadata({categoryIsAccesible:p,userType:a,site:i,identifier:r,currentDateArticle:c,weekNumber:$,year:f,category:s,isAccessibleForFree:d},u)}}else{let g=t.find(e=>e.product.name.toLowerCase()==l.toLowerCase());if(g){if(g.categorysAccess.length>0){let m=g.categorysAccess.find(e=>e.category.name.toLowerCase()==s.toLowerCase());validateMetadata({categoryIsAccesible:m,userType:a,site:i,identifier:r,currentDateArticle:c,weekNumber:$,year:f,category:s,isAccessibleForFree:d},u)}}else pintarModa()}}).catch(e=>{pintarModa()}):await requestPlanUser(o).then(e=>{if(e){p=e.userType?e.userType:"anonimo";let t=e.plansProductsCategory.find(e=>e.categorysAccess[0].category.name.toLowerCase()===s.toLowerCase());if(t){if(t.categorysAccess.length>0){let o=t.categorysAccess.find(e=>e.category.name.toLowerCase()==s.toLowerCase());validateMetadata({categoryIsAccesible:o,userType:p,site:i,identifier:r,currentDateArticle:c,weekNumber:$,year:f,category:s,isAccessibleForFree:d},u)}}else{let a=e.plansProductsCategory.find(e=>e.product.name.toLowerCase()==l.toLowerCase());if(a){if(a.categorysAccess.length>0){let n=a.categorysAccess.find(e=>e.category.name.toLowerCase()==s.toLowerCase());validateMetadata({categoryIsAccesible:n,userType:p,site:i,identifier:r,currentDateArticle:c,weekNumber:$,year:f,category:s,isAccessibleForFree:d},u)}}else pintarModa()}}}).catch(e=>{throw setError(),Error(e)})}}function setError(){pintarModa()}function isPlanExpired(e){let t=new Date,o=new Date(e);return t>o}function validateMetadata(e,t){if(e.categoryIsAccesible){if(!0==e.categoryIsAccesible.unlimited||e.categoryIsAccesible.amount>0){var o={uniqueId:t,userType:e.userType,site:e.site,metadata:{identifier:e.identifier,isAccessibleForFree:e.categoryIsAccesible.category.is_accessible_for_free,createDate:e.currentDateArticle,week:e.weekNumber+"-"+e.year,category:e.category}};let a=localStorage.getItem("id_kc");getMetadata({uniqueId:t,userType:e.userType,site:e.site,isAccessibleForFree:e.isAccessibleForFree,amount:e.categoryIsAccesible.amount,category:e.category,duration:e.categoryIsAccesible.duration,unlimited:e.categoryIsAccesible.unlimited,kc_id:a},function(t,a){if(!1==e.categoryIsAccesible.unlimited&&a.permissions.avalaible<1){if(a.segmentdisponibility)return requestPost(o,function(e,t){pintarModalSegments()});pintarModa(),console.log("ENTRO 2)))) ",e.categoryIsAccesible)}(!0==e.categoryIsAccesible.unlimited||a.permissions.avalaible>0)&&requestPost(o,function(e,t){e||console.log(" Almacenando nueva vista hoy ",t)})})}}else pintarModa()}function VentanaModal(e){var t=document.getElementById("myModal");document.getElementById("modalMessage").innerHTML=e,t.style.display="block",window.onclick=function(e){e.target==t&&(t.style.display="none")}}function cerrarModal(){document.body.classList.remove("modal-open"),document.getElementById("miModal").style.display="none",document.getElementById("miModal").style.display="none"}function abrirModal(){document.body.classList.add("modal-open"),document.getElementById("miModal").style.display="block";var e=document.getElementById("miModal");e.style.display="flex",e.style.display="block"}function pintarModa(){var e=document.createElement("style");e.innerHTML=styles,document.head.appendChild(e);var t=document.createElement("div");t.innerHTML=template,document.body.appendChild(t),document.querySelector(".modal-content"),abrirModal()}document.addEventListener("DOMContentLoaded",function(){let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/keycloak-js@22.0.5/dist/keycloak.min.js",e.onload=function(){let e=new Keycloak({url:"https://auth.loyaltywall.com/",realm:"loyaltywall-client-prod",clientId:"paywall-login"});window._kc=e;var t=document.getElementById("jsonLd");if(t){var o,a=JSON.parse(t.textContent||t.innerText);a.hasPart.length?a.hasPart.forEach(e=>{Array.isArray(e["@type"])&&e["@type"].includes("Product")&&(o=e.name)}):a.hasPart["@type"].includes("Product")&&(o=a.hasPart.name),initKeyCloak(e,t,o,a),createFloatingElements(e,a)}},document.head.appendChild(e)});var requestGetPlanSite=function(e,t){var o=new XMLHttpRequest;o.open("GET",admin_api+"/plans/81",!0),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?t(!1,JSON.parse(o.responseText)):(console.error("Error en la solicitud:",o.status),t(!0),localStorage.removeItem(e)))},o.send()},requestGetPlanSuscrite=function(e,t,o){var a=new XMLHttpRequest;a.open("GET",admin_api+"/plans/planuser/"+e+"/"+t,!0),a.onreadystatechange=function(){4===a.readyState&&(200===a.status&&o(!1,JSON.parse(a.responseText)),404===a.status&&(console.error("El usuario no se encuentra suscrito:",a.status),o(!0)),500===a.status&&(console.error("Error en la solicitud:",a.status),o(!0)))},a.send()},requestGet=function(e){var t=new XMLHttpRequest;t.open("GET",admin_api+"/paywall/metadata_paywall",!0),t.onreadystatechange=function(){4===t.readyState&&(200===t.status?JSON.parse(t.responseText):(console.error("Error en la solicitud:",t.status),localStorage.removeItem(e)))},t.send()},requestPost=function(e,t){var o=JSON.stringify(e),a=new XMLHttpRequest;a.open("POST",admin_api+"/paywall/metadata_paywall",!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(200===a.status||201===a.status){var e=JSON.parse(a.responseText),o=JSON.parse(e.pages);console.log(" pagesList ",o),t(!1,e.avalaible)}else t(!0),console.error("Error en la solicitud:",a.status)}},a.send(o)},getMetadata=function(e,t){var o=new XMLHttpRequest,a=admin_api+"/paywall/metadata_paywall?uniqueId="+encodeURIComponent(e.uniqueId)+"&userType="+encodeURIComponent(e.userType)+"&site="+encodeURIComponent(e.site)+"&isAccessibleForFree="+encodeURIComponent(e.isAccessibleForFree)+"&amount="+encodeURIComponent(e.amount)+"&category="+encodeURIComponent(e.category)+"&duration="+encodeURIComponent(e.duration)+"&unlimited="+encodeURIComponent(e.unlimited)+"&kc_id="+encodeURIComponent(e.kc_id);o.open("GET",a,!0),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?t(!1,JSON.parse(o.responseText)):(console.error("Error en la solicitud:",o.status),t(!0)))},o.send()};const requestPlanUser=async e=>{let t=localStorage.getItem(e+"_token"),o=await decodedJWT(t),a={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}},n=await fetch(`${admin_api}/paywall/getPlanByUserId?userId=${o.sub}`,a);if(!n.ok)throw Error("Se ha producido un nuevo error");let i=await n.json();return i},requestPlanMongoPost=function(e,t){var o=JSON.stringify(e),a=new XMLHttpRequest;a.open("POST",admin_api+"/paywall/plan_paywall",!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(200===a.status||201===a.status){var e=JSON.parse(a.responseText);JSON.parse(a.responseText),t(!1,e)}else console.error("Error en la solicitud:",a.status),t(!0)}},a.send(o)};function generateUniqueId(){return"ID_"+Math.random().toString(36).substring(2,15)}function getOrSetUniqueId(){let e=getCookie("uniqueId");return e||setCookie("uniqueId",e=generateUniqueId(),365),e}function setCookie(e,t,o){let a=new Date;a.setTime(a.getTime()+864e5*o),document.cookie=`${e}=${t};expires=${a.toUTCString()};path=/`}function getCookie(e){let t=`; ${document.cookie}`,o=t.split(`; ${e}=`);if(2===o.length)return o.pop().split(";").shift()}function validarCookie(e){let t=document.cookie.split(";"),o=t.find(t=>{let[o,a]=t.split("=").map(e=>e.trim());return o===e});return o?(console.log(`La cookie ${e} est\xe1 presente.`),!0):(console.log(`La cookie ${e} no est\xe1 presente.`),!1)}const comment_callback=function(){commentSectionEventFacebook()};async function commentSectionEventFacebook(){let e,t;var o=document.getElementById("jsonLd");if(o){var a=o.textContent||o.innerText;let n=JSON.parse(a);n.hasPart.length?n.hasPart.forEach(t=>{Array.isArray(t["@type"])&&t["@type"].includes("Product")&&(e=t.name)}):n.hasPart["@type"].includes("Product")&&(e=n.hasPart.name,t=n?.name)}let i=localStorage.getItem(e+"_token"),r=localStorage.getItem(e+"_user_data"),s={usuario:{correo:r.email,nombres:r.given_name,apellidos:r.family_name,identificacion:"98765412",celular:"3001111222"},plataforma:"Facebook",interaccion:"Comentar"},l=e,c=l.split("/"),d=`${url_base_loyaltiwall}/paywall/socialMedia`,p={method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({source:{itemId:t,itemType:"site",scope:c[2]},properties:s,target:{itemType:"page",scope:c[2],itemId:"homepage",properties:{pageInfo:{referringURL:l}}}})};try{return await (await fetch(d,p)).json()}catch(u){console.error("Error:",u)}}window.fbAsyncInit=function(){FB.init({appId:"384211001414287",cookie:!0,status:!0,xfbml:!0,version:"v20.0"}),FB.Event.subscribe("comment.create",comment_callback)};const template="<div id='miModal' class='modal-paywall'><div class='modal-content'><div class='plan-message'>\xa1Gracias por disfrutar de nuestro contenido!</div><div class='content-info'><p class='text-descriptive'> Parece que has alcanzado el l\xedmite de visualizaciones gratuitas. Para seguir explorando nuestro \n contenido exclusivo. te invitamos a registrarte o suscribirte para acceder a m\xe1s contenido exclusivo.</p><p class='text-call-action'>\xa1Reg\xedstrate o suscr\xedbete ahora para seguir disfrutando de la mejor experiencia!</p><div class='buttons-container'><button onclick='login()'>Inicia sesi\xf3n</button><button onclick='login()'>Suscr\xedbete!</button></div></div></div></div>";var styles=`
    .content-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 40px;
    }
    
    .text-descriptive{
        font-size: 16px;
        line-height: 22px;
        word-break: keep-all;
        overflow-wrap: break-word;
        hyphens: none;
        margin: 5px 0;
        text-align: center;
        font-weight: 400;
    }

    .buttons-container {
        margin: 15px 0px;
        width: 100%;
        justify-content: center;
        display: flex;
    }

    .buttons-container> button {
        width: 220px;
        border-radius: 8px;
        margin: 0px 15px;
        padding: 10px;
        cursor: pointer;
    }

    .buttons-container > button:first-child {
        background-color: #fff;
        font-size: 14px;
        border: 1px solid #C9D315;
        font-weight: 700;
        color: #000;
    }

    .buttons-container > button:nth-child(2) {
        background-color: #C9D315;
        font-size: 14px;
        border: 1px solid #C9D315;
        font-weight: 700;
        color: #000;
    }

    .text-call-action{
         margin: 5px 0;
        font-size: 18px;
        text-align: center;
        line-height: 28px;
        font-weight: 600;
    }

    .color-box {
      width: calc(33.33% - 10px);
      height: 300px;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      box-sizing: border-box;
      text-align: center;
      border: 1px solid #888; /* Borde de 2px */
      margin-bottom: 10px; /* Espacio entre los divs de plan */
      position: relative; /* Para que la posici\xf3n absoluta del icono sea relativa a este div */
    }


    .plan-message {
        text-align: center;
        font-size: 18px;
        margin-bottom: 20px;
        font-family: sans-serif;
        font-style: inherit;
        font-weight: bold;
        background-color: #C9D315;
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
        padding: 16px;
    }

    .color-box span {
      color: white; /* Ajusta el color del texto seg\xfan el fondo del div */
    }

    .modal-paywall {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 9999;
    }

    .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        border: 1px solid #888;
        width: 80%;
        position: relative;
        border-radius: 16px;
        border-bottom: 8px solid black;
    }

    .close {
      position: absolute;
      top: 0;
      right: 0;
      padding: 10px;
      cursor: pointer;
    }

    .modal-open {
      overflow: hidden;
    }
`;const styleButtonAuth=`
    .floating-element {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      z-index: 9999
    }

    .floating-element button,
    .floating-element div {
      margin-bottom: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .floating-button {
      padding: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .floating-button:hover {
      background-color: #2980b9;
    }

    .floating-div {
      width: 100px;
      height: 100px;
      background-color: #e74c3c;
      border-radius: 5px;
    }
`;function comprarPlan(e){alert("\xa1Plan "+e+" comprado!")}function pintarModalSegments(){var e=document.createElement("style");e.innerHTML=stylesModalSegments,document.head.appendChild(e);var t=document.createElement("div");t.innerHTML=templateModalSegments,document.body.appendChild(t),document.querySelector(".modal-segment-content"),abrirModalSegmentos()}function cerrarModalSegmentos(){document.body.classList.remove("modal-segments-open"),document.getElementById("modalSegments").style.display="none",document.getElementById("modalSegments").style.display="none"}function abrirModalSegmentos(){document.body.classList.add("modal-segments-open"),document.getElementById("modalSegments").style.display="block";var e=document.getElementById("modalSegments");e.style.display="flex",e.style.display="block"}const templateModalSegments="<div id='modalSegments' class='modal'><div class='modal-segment-content'><div class='plan-segment-message'>\xa1Gracias por disfrutar de nuestro contenido!</div><div class='content-segment-info'><p class='text-segment-descriptive'> Parece que has alcanzado el l\xedmite de visualizaciones gratuitas.</p><p class='text-segment-call-action'>\xa1Por pertenecer a uno de nuestros segmentos puedes continuar disfrutando nuestro contenido!</p><div class='buttons-segment-container'><button onclick='cerrarModalSegmentos()'>Aceptar</button></div></div></div></div>",stylesModalSegments=`
.content-segment-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 40px;
}

.text-segment-descriptive{
    font-size: 16px;
    line-height: 22px;
    word-break: keep-all;
    overflow-wrap: break-word;
    hyphens: none;
    margin: 5px 0;
    text-align: center;
    font-weight: 400;
}

.buttons-segment-container {
    margin: 15px 0px;
    width: 100%;
    justify-content: center;
    display: flex;
}

.buttons-segment-container> button {
    width: 220px;
    border-radius: 8px;
    margin: 0px 15px;
    padding: 10px;
    cursor: pointer;
}

.buttons-segment-container > button:first-child {
    background-color: #fff;
    font-size: 14px;
    border: 1px solid #C9D315;
    font-weight: 700;
    color: #000;
}

.buttons-segment-container > button:first-child:hover {
    background-color: #C9D315;
    font-size: 14px;
    border: 1px solid #C9D315;
    font-weight: 700;
    color: #000;
}

.text-segment-call-action{
    margin: 5px 0;
    font-size: 18px;
    text-align: center;
    line-height: 28px;
    font-weight: 600;
}

.color-box {
width: calc(33.33% - 10px);
height: 300px;
display: inline-flex;
flex-direction: column;
align-items: center;
justify-content: center;
margin-right: 10px;
box-sizing: border-box;
text-align: center;
border: 1px solid #888; /* Borde de 2px */
margin-bottom: 10px; /* Espacio entre los divs de plan */
position: relative; /* Para que la posici\xf3n absoluta del icono sea relativa a este div */
}


.plan-segment-message {
    text-align: center;
    font-size: 18px;
    margin-bottom: 20px;
    font-family: sans-serif;
    font-style: inherit;
    font-weight: bold;
    background-color: #C9D315;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    padding: 16px;
}

.color-box span {
color: white; /* Ajusta el color del texto seg\xfan el fondo del div */
}

.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.7);
}

.modal-segment-content {
    background-color: #fefefe;
    margin: 10% auto;
    border: 1px solid #888;
    width: 80%;
    position: relative;
    border-radius: 16px;
    border-bottom: 8px solid black;
}

.close {
position: absolute;
top: 0;
right: 0;
padding: 10px;
cursor: pointer;
}

.modal-segments-open {
overflow: hidden;
}
`;